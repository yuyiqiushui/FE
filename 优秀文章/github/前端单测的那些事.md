# [å‰ç«¯å•æµ‹çš„é‚£äº›äº‹](https://github.com/muwoo/blogs/issues/33)

## å‰è¨€

å› ä¸ºç»å¸¸éœ€è¦ç»´æŠ¤ä¸€äº›å¤§å‹çš„ä¸šåŠ¡é¡¹ç›®å’Œä¸€äº›è‡ªå·±çš„å¼€æºé¡¹ç›®ï¼Œæ‰€ä»¥ä¸ºäº†æ›´å¥½çš„â€œè§„èŒƒâ€ä»£ç è´¨é‡å’Œè¿­ä»£çš„ç¨³å®šæ€§ï¼Œå¼€å§‹å†™äº†ä¸€äº›å•æµ‹ã€‚ä¸‹é¢ä¹Ÿä¸»è¦æ˜¯è‡ªå·±çš„ä¸€äº›æ€»ç»“å§ï¼Œç”±äºæµ‹è¯•å·¥å…·å’Œæ¡†æ¶å¾ˆå¤šï¼Œè¿™é‡Œåªä»‹ç»ä¸€äº›browserç«¯å¸¸ç”¨çš„æµ‹è¯•å·¥å…·ï¼Œæ–‡ä¸­å¦‚æœæœ‰é—®é¢˜ä¹Ÿæ¬¢è¿æ‹æ­£ï¼ï¼ğŸ™‚

## ä¸ºä½•è¦æµ‹è¯•

ä¹‹å‰æˆ‘ä»¬å¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šå¿½ç•¥å»å†™ä¸€å†™å•æµ‹ï¼Œå¤§å¤šæ•°åŸå› å¯èƒ½æ˜¯è§‰å¾—æ²¡æœ‰æ—¶é—´æˆ–è€…æ˜¯æµªè´¹æ—¶é—´ã€‚è€Œä¸”è¿˜éœ€è¦å»ç»´æŠ¤æµ‹è¯•ç”¨ä¾‹ã€‚
å…¶å®ä¸€èˆ¬é¡¹ç›®éšç€æ—¶é—´çš„è¿ç§»ï¼Œä¼šå˜å¾—è¶Šæ¥è¶Šå¤æ‚å’Œåºå¤§ï¼Œè¿™æ—¶å€™å¦‚æœæˆ‘ä»¬å¯¹æŸä¸€ä¸ªå…¬å…±æ¨¡å—æ”¹åŠ¨ï¼Œè€Œå…¶ä»–äººä¹Ÿä¾èµ–äº†è¿™ä¸ªæ¨¡å—ï¼Œå¯èƒ½å°±ä¼šå¯¼è‡´åˆ«äººçš„åŠŸèƒ½å‡ºç°bugã€‚
æœ‰äº†è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¼€å‘è€…ä¼šæ›´åŠ ä¿¡ä»»è‡ªå·±çš„ä»£ç ã€‚å¼€å‘è€…å†ä¹Ÿä¸ä¼šæƒ§æ€•å°†ä»£ç äº¤ç»™åˆ«äººç»´æŠ¤ï¼Œä¸ç”¨æ‹…å¿ƒåˆ«çš„å¼€å‘è€…åœ¨ä»£ç é‡Œæâ€œç ´åâ€ã€‚åäººæ¥æ‰‹ä¸€æ®µæœ‰æµ‹è¯•ç”¨ä¾‹çš„ä»£ç ï¼Œä¿®æ”¹èµ·æ¥ä¹Ÿä¼šæ›´åŠ ä»å®¹ã€‚æµ‹è¯•ç”¨ä¾‹é‡Œéå¸¸æ¸…æ¥šçš„é˜é‡Šäº†å¼€å‘è€…å’Œä½¿ç”¨è€…å¯¹äºè¿™ç«¯ä»£ç çš„æœŸæœ›å’Œè¦æ±‚ï¼Œä¹Ÿéå¸¸æœ‰åˆ©äºä»£ç çš„ä¼ æ‰¿ã€‚

## ä¸€äº›æ¦‚å¿µ

#### TDD (Test Driven Development)

TDD ä¹Ÿå°±æ˜¯æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œç®€å•çš„è¯´ï¼Œå³åœ¨å†™ä»»ä½•åŠŸèƒ½ä»£ç ä¹‹å‰ï¼Œå…ˆå†™å®ƒçš„æµ‹è¯•ä»£ç ã€‚å…·ä½“æ­¥éª¤ï¼š

- æ ¹æ®éœ€è¦ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹
- ç¼–å†™åŠŸèƒ½ä»£ç ï¼Œä»¥è®©åˆšæ‰çš„æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- é€æ­¥è¡¥å……æµ‹è¯•ç”¨ä¾‹
- ä¿®æ”¹åŠŸèƒ½ä»£ç ä½¿æ–°å¢çš„æµ‹è¯•ç”¨ä¾‹å’ŒåŸæ¥çš„éƒ½é€šè¿‡
- é‡æ„ï¼ŒåŒ…æ‹¬åŠŸèƒ½ä»£ç å’Œæµ‹è¯•ç”¨ä¾‹

#### BDD(Behaviour Driven Development)

BDD å³ è¡Œä¸ºé©±åŠ¨å¼€å‘ï¼Œå¯ä»¥ç†è§£ä¸ºä¹Ÿæ˜¯ TDD çš„åˆ†æ”¯ï¼Œå³ä¹Ÿæ˜¯æµ‹è¯•é©±åŠ¨ï¼Œä½† BDD å¼ºè°ƒçš„æ˜¯å†™æµ‹è¯•çš„é£æ ¼ï¼Œå³æµ‹è¯•è¦å†™å¾—åƒè‡ªç„¶è¯­è¨€ï¼Œè¿ç”¨ä¸€äº›æ¯”å¦‚`expectã€should`ç­‰è·Ÿè‡ªç„¶è¯­è¨€ç›¸è¿‘çš„æ–­è¨€ï¼Œè®©é¡¹ç›®çš„å„ä¸ªæˆå‘˜ç”šè‡³äº§å“éƒ½èƒ½çœ‹æ‡‚æµ‹è¯•ï¼Œç”šè‡³ç¼–å†™æµ‹è¯•ã€‚

#### å†™æ³•å¯¹æ¯”

ä¸ç®¡æ˜¯ TDD è¿˜æ˜¯ BDDï¼Œæˆ‘ä»¬æ¥å¯¹æ¯”ä¸€äº›äºŒè€…çš„å†™æ³•ï¼š

```js
  // TDD
  suite('Array', function() {
    setup(function() {
    });

    test('equal -1 when index beyond array length', function() {
      assert.equal(-1, [1,2,3].indexOf(4));
    });
  });

  // BDD
  describe('Array', function() {
    before(function() {
    });

    it('should return -1 when no such index', function() {
      [1,2,3].indexOf(4).should.equal(-1);
    });
  });
```

ç®€å•çš„çœ‹ï¼Œ BDD é£æ ¼å†™çš„ä¼šæ›´å®¹æ˜“ç†è§£ï¼Œæ›´åŠ è¯­ä¹‰åŒ–ã€‚

#### æ–­è¨€(assert)

åœ¨å•å…ƒæµ‹è¯•æ—¶ï¼Œå¼€å‘é¢„è®¡åœ¨ç¨‹åºè¿è¡Œåˆ°æŸä¸ªèŠ‚ç‚¹ä½ç½®ï¼Œéœ€è¦åˆ¤æ–­æŸäº›é€»è¾‘æ¡ä»¶å¿…é¡»æ»¡è¶³ï¼Œè¿™æ ·ä¸‹é¢çš„ä¸€äº›ä¸šåŠ¡é€»è¾‘æ‰å¯ä»¥è¿›è¡Œä¸‹å»ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œç¨‹åºå°±ä¼š"æŠ¥é”™"ç”šè‡³æ˜¯"å´©æºƒ"ã€‚æ–­è¨€åœ¨å•æµ‹ä¸­ï¼Œä¹Ÿæ˜¯ä¸»è¦ç”¨æ¥ç¡®å®šæŸæ®µç¨‹åºæ‰§è¡Œç»“æœåº”è¯¥æ˜¯æŸä¸ªå€¼è¿™æ ·çš„ä¸€ä¸ªé¢„æœŸã€‚

#### ä¸€äº›æ–­è¨€åº“çš„æ¯”è¾ƒ

æ–­è¨€åº“å³æä¾›ä¸€å¥— API å¸®åŠ©å¼€å‘è€…åœ¨å•å…ƒæµ‹è¯•çš„è¿‡ç¨‹ä¸­åˆ¤å®šæŸä¸ªå€¼æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæ¯”å¦‚ï¼š

###### [should.js](https://github.com/shouldjs/should.js)

```js
  value.should.equal(1);
  value.should.be.an.Object();
```

##### [expect.js](https://github.com/Automattic/expect.js)

```js
expect(value).to.be(1)
expect(value).to.be.an('object')
```

#### [chai](https://github.com/chaijs/chai)

> Chai is a BDD / TDD assertion library for node and the browser that can be delightfully paired with any javascript testing framework.

chai æä¾›äº†ä¸‰ç§æ–­è¨€é£æ ¼æ¥åˆ†åˆ«é€‚ç”¨äº BDD å’Œ TDDã€‚`expect/should` API å¯¹åº”BDDé£æ ¼ï¼Œ`Assert API` å¯¹åº”TDDé£æ ¼ã€‚
[![image](https://user-images.githubusercontent.com/21073039/44142145-e3cf8b48-a0b1-11e8-9b07-e25b871321ee.png)](https://user-images.githubusercontent.com/21073039/44142145-e3cf8b48-a0b1-11e8-9b07-e25b871321ee.png)

## æµ‹è¯•æ¡†æ¶

æ‰€è°“"æµ‹è¯•æ¡†æ¶"ï¼Œå°±æ˜¯è¿è¡Œæµ‹è¯•çš„å·¥å…·ã€‚é€šè¿‡å®ƒï¼Œå¯ä»¥ä¸º`JavaScript`åº”ç”¨æ·»åŠ æµ‹è¯•ï¼Œä»è€Œä¿è¯ä»£ç çš„è´¨é‡ã€‚

#### [Mocha](https://github.com/mochajs/mocha)

`Mocha`ï¼ˆå‘éŸ³"æ‘©å¡"ï¼‰è¯ç”Ÿäº2011å¹´ï¼Œæ˜¯ç°åœ¨æœ€æµè¡Œçš„JavaScriptæµ‹è¯•æ¡†æ¶ä¹‹ä¸€ï¼Œåœ¨æµè§ˆå™¨å’ŒNodeç¯å¢ƒéƒ½å¯ä»¥ä½¿ç”¨ã€‚
æ›´å¤šå…³äº`mocha`çš„ä½¿ç”¨å’Œä»‹ç»å¯ä»¥å‚è€ƒé˜®è€å¸ˆçš„è¿™ç¯‡æ–‡ç« [æµ‹è¯•æ¡†æ¶ Mocha å®ä¾‹æ•™ç¨‹](http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html)

#### [Jasmine](https://github.com/jasmine/jasmine)

Jasmine ä¸ä¾èµ–äºä»»ä½•æ¡†æ¶ï¼Œæ‰€ä»¥é€‚ç”¨äºæ‰€æœ‰çš„ Javascript ä»£ç ã€‚ä½¿ç”¨ä¸€ä¸ªå…¨å±€å‡½æ•° `describe` æ¥æè¿°æ¯ä¸ªæµ‹è¯•ï¼Œå¹¶ä¸”å¯ä»¥åµŒå¥—ã€‚`describe`å‡½æ•°æœ‰2ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ç”¨äºæè¿°ï¼Œä¸€ä¸ªæ˜¯å‡½æ•°ç”¨äºæµ‹è¯•ã€‚åœ¨è¯¥å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨å…¨å±€å‡½æ•°` it` æ¥å®šä¹‰`Specs`ï¼Œä¹Ÿå°±æ˜¯å•å…ƒæµ‹è¯•çš„ä¸»è¦å†…å®¹ï¼Œ ä½¿ç”¨ `expect` å‡½æ•°æ¥æµ‹è¯•ï¼š

```js
describe("A suite is just a function", function() {
  var a;
  it("and so is a spec", function() {
    a = true;
    expect(a).toBe(true);
  });
});
```

## å‰ç«¯æµ‹è¯•å·¥å…·

ç›¸æ¯”äºæœåŠ¡ç«¯å¼€å‘ï¼Œå‰ç«¯å¼€å‘åœ¨æµ‹è¯•æ–¹é¢å§‹ç»ˆé¢ä¸´ç€ä¸€ä¸ªä¸¥å³»çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯æµè§ˆå™¨å…¼å®¹æ€§ã€‚å‰ç«¯å¼€å‘ä¸­æµè§ˆå™¨å…¼å®¹æ€§æ˜¯ä¸€ä¸ªæ°¸è¿œçš„é—®é¢˜ï¼Œè€Œä¸”æˆ‘è®¤ä¸ºå³ä½¿è§£å†³äº†æµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ï¼Œæœªæ¥åœ¨ç§»åŠ¨å¼€å‘æ–¹é¢ï¼Œè®¾å¤‡å…¼å®¹æ€§ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚

æ‰€ä»¥åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹é¢ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå³ä½¿æ‰€æœ‰çš„å•å…ƒæµ‹è¯•é›†ä¸­åœ¨äº†ä¸€ä¸ªrunnerä¸­ï¼Œå‰ç«¯æµ‹è¯•ä»ç„¶è¦é¢å¯¹è‡³å°‘4ä¸ªæµè§ˆå™¨å†…æ ¸ä»¥åŠ3ä¸ªç”µè„‘æ“ä½œç³»ç»ŸåŠ 2ä¸ªæˆ–æ›´å¤šç§»åŠ¨æ“ä½œç³»ç»Ÿï¼Œä½•å†µè¿˜æœ‰ä»¤ç§»åŠ¨å¼€å‘äººå‘˜å¤´ç–¼çš„Androidçš„ç¢ç‰‡åŒ–é—®é¢˜ã€‚ä¸è¿‡å¯ä»¥å®‰å¿ƒçš„æ˜¯ï¼Œæ—©å·²å­˜åœ¨è¿™æ ·çš„å·¥å…·å¯ä»¥æ•è·ä¸åŒè®¾å¤‡ä¸Šçš„ä¸åŒæµè§ˆå™¨ï¼Œå¹¶ä½¿ä¹‹éšæ—¶æ›´æ–°æµ‹è¯•ç»“æœï¼Œç”šè‡³å¯ä»¥åœ¨ä¸€ä¸ªç»ˆç«¯ä¸Šçœ‹åˆ°æ‰€æœ‰ç»“æœã€‚ä¸‹é¢æˆ‘ä»¬ä¸»è¦ä»‹ç» [Karma](http://karma-runner.github.io/2.0/index.html)

## Karma

Karmaæ˜¯ä¸€ä¸ªåŸºäº Node.js çš„ JavaScript æµ‹è¯•æ‰§è¡Œè¿‡ç¨‹ç®¡ç†å·¥å…·ï¼ˆTest Runnerï¼‰ã€‚è¯¥å·¥å…·å¯ç”¨äºæµ‹è¯•æ‰€æœ‰ä¸»æµWebæµè§ˆå™¨ï¼Œä¹Ÿå¯é›†æˆåˆ° CIï¼ˆContinuous integrationï¼‰å·¥å…·ï¼Œä¹Ÿå¯å’Œå…¶ä»–ä»£ç ç¼–è¾‘å™¨ä¸€èµ·ä½¿ç”¨ã€‚è¿™ä¸ªæµ‹è¯•å·¥å…·çš„ä¸€ä¸ªå¼ºå¤§ç‰¹æ€§å°±æ˜¯ï¼Œå®ƒå¯ä»¥ç›‘æ§(Watch)æ–‡ä»¶çš„å˜åŒ–ï¼Œç„¶åè‡ªè¡Œæ‰§è¡Œï¼Œé€šè¿‡`console.log`æ˜¾ç¤ºæµ‹è¯•ç»“æœã€‚

[æ–‡æ¡£](https://karma-runner.github.io/2.0/index.html)

## Istanbul

æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸¸å¸¸å…³å¿ƒï¼Œæ˜¯å¦æ‰€æœ‰ä»£ç éƒ½æµ‹è¯•åˆ°äº†ã€‚
è¿™ä¸ªæŒ‡æ ‡å°±å«åš"ä»£ç è¦†ç›–ç‡"ï¼ˆcode coverageï¼‰ã€‚å®ƒæœ‰å››ä¸ªæµ‹é‡ç»´åº¦ã€‚

- è¡Œè¦†ç›–ç‡ï¼ˆline coverageï¼‰ï¼šæ˜¯å¦æ¯ä¸€è¡Œéƒ½æ‰§è¡Œäº†ï¼Ÿ
- å‡½æ•°è¦†ç›–ç‡ï¼ˆfunction coverageï¼‰ï¼šæ˜¯å¦æ¯ä¸ªå‡½æ•°éƒ½è°ƒç”¨äº†ï¼Ÿ
- åˆ†æ”¯è¦†ç›–ç‡ï¼ˆbranch coverageï¼‰ï¼šæ˜¯å¦æ¯ä¸ªifä»£ç å—éƒ½æ‰§è¡Œäº†ï¼Ÿ
- è¯­å¥è¦†ç›–ç‡ï¼ˆstatement coverageï¼‰ï¼šæ˜¯å¦æ¯ä¸ªè¯­å¥éƒ½æ‰§è¡Œäº†ï¼Ÿ

è¿™ä¸ªè½¯ä»¶ä»¥åœŸè€³å…¶æœ€å¤§åŸå¸‚ä¼Šæ–¯å¦å¸ƒå°”å‘½åï¼Œå› ä¸ºåœŸè€³å…¶åœ°æ¯¯ä¸–ç•Œé—»åï¼Œè€Œåœ°æ¯¯æ˜¯ç”¨æ¥è¦†ç›–çš„ã€‚

è¯¦ç»†çš„æ–‡æ¡£å‚è€ƒé˜®è€å¸ˆçš„[ä»£ç è¦†ç›–ç‡å·¥å…· Istanbul å…¥é—¨æ•™ç¨‹](http://www.ruanyifeng.com/blog/2015/06/istanbul.html)

## åŠ¨æ‰‹ï¼

ä¸‹é¢æˆ‘ä»¬æ¥æ­å»ºä¸€ä¸ªES6 + jasmine + karma + Istanbul + webpack çš„åŸºç¡€æµ‹è¯•å·¥å…·ã€‚
é¦–å…ˆæ¥æ­å»ºä¸€ä¸ªç®€å•çš„`es6`ç¯å¢ƒï¼š

```js
mkdir example

cd example

npm i babel-core bable-loader babel-preset-env --save
```

ç„¶ååˆ›å»º`.babelrc`æ–‡ä»¶

```js
{
    "presets": [
        "env"
    ]
}
```

æ¥ç€æˆ‘ä»¬éœ€è¦å®‰è£… `karma` æµ‹è¯•å·¥å…·ï¼š

```js
$ npm install karma --save-dev

$ npm install karma-jasmine karma-chrome-launcher jasmine-core --save-dev
```

æ¥ä¸‹æ¥åˆå§‹åŒ–`karma`:

```js
karma init
```

[![image](https://user-images.githubusercontent.com/21073039/44207389-9ced6900-a18f-11e8-9667-c09642547253.png)](https://user-images.githubusercontent.com/21073039/44207389-9ced6900-a18f-11e8-9667-c09642547253.png)

è¿™æ ·ç›®å½•ä¸­ä¾¿ä¼šå¤šäº†ä¸€ä¸ª`karma.conf.js`è¿™æ ·çš„ä¸€ä¸ªæ–‡ä»¶ã€‚ä¸ºäº†åœ¨æµ‹è¯•çš„æ—¶å€™å¯ä»¥ä½¿ç”¨`es6`ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`karma-webpack`ï¼š

```js
npm i webpack karma-webpack --save
```

æ¥ä¸‹æ¥ï¼Œå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„å·¥ä½œäº†ï¼Œå†™ä¸€ä¸ªåŠ è½½æµ‹è¯•è„šæœ¬çš„`webpack`é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚`webpack.test.js`:

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: {
          loader: "babel-loader"
        }
      }
    ]
  }
};
```

å†æ”¹å†™ä¸€ä¸‹æˆ‘ä»¬çš„`karma.conf.js`ï¼Œ å¼•å…¥`webpack`:

```js
const webpack = require('../webpack.config')

module.exports = function(config) {
  config.set({
    basePath: '',
    frameworks: ['jasmine'],
    files: [
      'test/**/*.spec.js'
    ],
    exclude: [
    ],
    preprocessors: {
      'test/add.spec.js': ['webpack']
    },
    webpack: webpack,
    reporters: ['progress'],
    port: 9876,
    colors: true,
    logLevel: config.LOG_INFO,
    autoWatch: true,
    browsers: ['Chrome'],
    singleRun: false,
    concurrency: Infinity
  })
}
```

è¿è¡Œ`karma start`ã€‚
[![image](https://user-images.githubusercontent.com/21073039/44330670-3079af00-a49a-11e8-9300-df9c1dc94029.png)](https://user-images.githubusercontent.com/21073039/44330670-3079af00-a49a-11e8-9300-df9c1dc94029.png)

å½“å‰æˆ‘ä»¬çš„`reporters`è®¾ç½®çš„æ˜¯`progress`ï¼Œæ‰€ä»¥åªä¼šå±•ç¤ºæœ€ç»ˆæµ‹è¯•ç»“æœï¼Œå’Œæ‰§è¡Œé”™è¯¯çš„è¯­å¥ã€‚å¦‚æœä½ æƒ³çœ‹åˆ°æ¯ä¸€æ¡çš„æ‰§è¡Œç»“æœï¼Œå¯ä»¥å®‰è£…[karma-spec-reporter](https://github.com/mlex/karma-spec-reporter)

```
npm install karma-spec-reporter --save-dev
```

ç„¶ååŠ å…¥`spec`åˆ°karma.conf.js çš„ `reporters`ä¸­ï¼š

```
reporters: ['spec']
```

è¿™æ ·å°±ä¼šç”Ÿæˆè¿™æ ·çš„å½¢å¼æŠ¥å‘Šï¼š
[![image](https://user-images.githubusercontent.com/21073039/44330930-d4635a80-a49a-11e8-98d5-be33ed2f4502.png)](https://user-images.githubusercontent.com/21073039/44330930-d4635a80-a49a-11e8-98d5-be33ed2f4502.png)

å…¶æ¬¡æˆ‘ä»¬éœ€è¦æ·»åŠ `istanbul`è¿›è¡Œä»£ç è¦†ç›–ç‡æµ‹è¯•ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ª`babel`æ’ä»¶ï¼š

```
npm install babel-plugin-istanbul --save-dev 
```

ç„¶åä¿®æ”¹æˆ‘ä»¬çš„`.babelrc`æ–‡ä»¶ï¼š

```js
{
  // ...
  "env": {
    "test": {
      "presets": ["env"],
      "plugins": ["istanbul"]
    }
  }
}
```

é€šè¿‡ä½¿ç”¨`.babelrc`é‡Œçš„`env`å±æ€§ï¼Œå½“æˆ‘ä»¬é€šè¿‡è®¾ç½®`BABEL_ENV=test`çš„æ—¶å€™ä¾¿å¯ä»¥å»æ‰§è¡Œä»£ç æµ‹è¯•çš„ç›¸å…³æ’ä»¶ï¼Œè¿™åœ¨å¤æ‚é¡¹ç›®ä¸­çš„æµ‹è¯•é…ç½®ä¸­å¾ˆæœ‰ç”¨ã€‚
æ¥ä¸‹æ¥ï¼Œä¸ºäº†èƒ½ç”Ÿæˆè¦†ç›–ç‡æµ‹è¯•æŠ¥å‘Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£…ä¸€ä¸ª karma Istanbul æ’ä»¶`karma-coverage`:

```js
npm install karma karma-coverage --save-dev
```

ç„¶åæˆ‘ä»¬æ”¹ä¸€ä¸‹`package.json`é‡Œé¢çš„`script`è„šæœ¬ï¼š

```js
"scripts": {
    "test": "cross-env BABEL_ENV=test karma start test/karma.conf.js"
}
```

è¿è¡Œ

```
npm run test
```

æ‰“å¼€ `coverage`é‡Œé¢çš„`index.html`æ–‡ä»¶ï¼š
[![image](https://user-images.githubusercontent.com/21073039/44332232-31acdb00-a49e-11e8-9741-3799f7ef6b5b.png)](https://user-images.githubusercontent.com/21073039/44332232-31acdb00-a49e-11e8-9741-3799f7ef6b5b.png)

å¯ä»¥çœ‹åˆ°è¦†ç›–ç‡çš„ä¸€äº›æµ‹è¯•ç»“æœã€‚ä½†æ˜¯è¿™æ ·æœ‰ç‚¹ä¸å¤ªæ–¹ä¾¿ï¼Œå¸Œæœ›èƒ½å¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å°è¾“å‡ºå°±å¥½äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ”¹ä¸€ä¸‹`karma.conf.js`æ–‡ä»¶ï¼ŒåŠ ä¸Šè¿™æ ·ä¸€ä¸ªå±æ€§ï¼š

```js
coverageReporter: {
    dir: './coverage',
    reporters: [
        { type: 'lcov', subdir: '.' },
        { type: 'text-summary' } // åœ¨æ§åˆ¶å°è¾“å‡ºæ‘˜è¦
    ]
}
```

è¿™æ ·æˆ‘ä»¬åœ¨æ§åˆ¶å°ä¾¿å¯ä»¥æ‰“å°å‡ºåŸºæœ¬çš„è¦†ç›–ç‡æµ‹è¯•ç»“æœï¼š
[![image](https://user-images.githubusercontent.com/21073039/44332427-9c5e1680-a49e-11e8-80c2-b7d60e4758b6.png)](https://user-images.githubusercontent.com/21073039/44332427-9c5e1680-a49e-11e8-80c2-b7d60e4758b6.png)

è‡³æ­¤ã€‚å·²ç»å®Œæˆäº†ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒçš„æ­å»ºï¼Œå¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†å·¥ç¨‹çš„å•æµ‹é…ç½®ã€‚

## ç»“è¯­

å¯èƒ½å¹³æ—¶ç”±äºå¤§å®¶æ›´åŠ å…³å¿ƒä¸šåŠ¡ä»£ç ï¼Œè€Œä¼šå¿½ç•¥ä¸€äº›å‰ç«¯çš„æµ‹è¯•å·¥ä½œï¼Œç½‘ä¸Šçš„èµ„æ–™ä¹Ÿæ˜¯é›¶é›¶ç¢ç¢çš„ï¼Œæ²¡æœ‰ä¸€ä¸ªç³»ç»Ÿçš„æ€»ç»“å’Œä»‹ç»ã€‚è¿™é‡Œæ•´ç†äº†ä¸€äº›æµ‹è¯•å·¥å…·çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¸Œæœ›å¯ä»¥å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚ç„¶åæœ¬æ–‡æ‰€æœ‰ä»£ç å’ŒåŸå§‹å‡ºå¤„å‘è¡¨åœ¨ä¸ªäººåšå®¢ä¸­ã€‚ä¹Ÿæ¬¢è¿é˜…è¯»ä¹‹å‰çš„åšæ–‡ï¼š

[muwoo çš„ blogs](https://github.com/muwoo/blogs)

[å•æµ‹demo](https://github.com/muwoo/blogs/tree/master/src/test)

## å‚è€ƒæ–‡ç« 

[æµ‹è¯•æ¡†æ¶ Mocha å®ä¾‹æ•™ç¨‹](http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html)

[ä»£ç è¦†ç›–ç‡å·¥å…· Istanbul å…¥é—¨æ•™ç¨‹](http://www.ruanyifeng.com/blog/2015/06/istanbul.html)

[Node.js å•å…ƒæµ‹è¯•ï¼šæˆ‘è¦å†™æµ‹è¯•](http://taobaofed.org/blog/2015/12/10/nodejs-unit-tests/)

[å…³äºå‰ç«¯å¼€å‘è°ˆè°ˆå•å…ƒæµ‹è¯•](https://segmentfault.com/a/1190000000317146)